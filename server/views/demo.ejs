<html>
<script type="text/javascript">
    document.addEventListener("DOMContentLoaded", function (event) {
        var frame = document.getElementById('frame');
        frame.onload = function () {
            window.removeEventListener('message', onBrowserMessageReceived);
            window.addEventListener('message', onBrowserMessageReceived);
        };
    });

    function onBrowserMessageReceived(msg) {
        // check if it is a valid message.
        if (!msg.data || !msg.data.params) {
            return;
        }
        var data = msg.data;

        var selectedArea = document.getElementById('selectedArea');
        selectedArea.style.display = 'block';

        var selectedId = document.getElementById('selectedId');
        var selectedName = document.getElementById('selectedName');
        var selectedType = document.getElementById('selectedType');
        var selectedUrl = document.getElementById('selectedUrl');
        var selectedLink = document.getElementById('selectedLink');


        selectedName.innerHTML = 'Name = ' + data.name;
        selectedLink.innerHTML = '<a href="' + data.url + '" target="_blank">' + data.url + '</a>';

        // what type of message is it?
        switch (data.params.event) {
            case 'composition_selected':
                selectedType.innerHTML = 'Type = Composition';
                selectedId.innerHTML = 'ID = ' + data.params.composition.refId;
                selectedUrl.innerHTML = 'URL = ' + data.params.composition.url;
                break;
            case 'app_selected':
                selectedType.innerHTML = 'Type = App';
                selectedId.innerHTML = 'ID = ' + data.params.app.refId;
                selectedUrl.innerHTML = 'URL = ' + data.params.app.url;
                break;
            case 'image_selected':
                selectedType.innerHTML = 'Type = Image';
                selectedId.innerHTML = 'ID = ' + data.params.image.refId;
                selectedUrl.innerHTML = 'URL = ' + data.params.image.url;
                break;
            case 'audio_selected':
                selectedType.innerHTML = 'Type = Audio';
                selectedId.innerHTML = 'ID = ' + data.params.audio.refId;
                selectedUrl.innerHTML = 'URL = ' + data.params.audio.url;
                break;
            default:
                selectedArea.style.display = 'none';
                break;
        }
    }

    function showBrowser(type) {
        // construct the browser URL
        frame.src = '<%= singularUrlBase %>/externals/browser?type=' + type + '&showSearch=true&showHeader=true';

        // hide the fields that show the select element
        document.getElementById('selectedArea').style.display = 'none';
    }
</script>

<body>
    <table style="width: 100%">
        <tr>
            <td style="vertical-align: top; width: 30%">
                <h2>Your profile</h2>
                <ul>
                    <li>Name = <%= user.name %></li>
                    <li>Email = <%= user.email %></li>
                </ul>
                <h2>Play with browsers</h2>
                <ul>
                    <li><a href='#' onClick="showBrowser('composition')">Open Composition Browser</a></li>
                    <li><a href='#' onClick='showBrowser("appinstance")'>Open App Browser</a></li>
                    <li><a href='#' onClick='showBrowser("image")'>Open Image Browser</a></li>
                    <li><a href='#' onClick='showBrowser("audio")'>Open Audio Browser</a></li>
                </ul>
                <a href="<%= singularUrlBase %>/users/logout">Logout</a>
            </td>
            <td style="vertical-align: top;">
                <iframe id="frame" style="border: 0px; width: 100%; height: 600px"></iframe>
                <div id="selectedArea" style="display:none">
                    <h3>Selected Element</h3>
                    <p>
                        <div id="selectedType"></div>
                        <div id="selectedId"></div>
                        <div id="selectedName"></div>
                        <div id="selectedUrl"></div>
                        <div id="selectedLink"></div>
                    </p>
                </div>
            </td>
        </tr>
    </table>

</body>

</html>