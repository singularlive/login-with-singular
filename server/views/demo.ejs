<html>
<script type="text/javascript">
    document.addEventListener("DOMContentLoaded", function (event) {
        var frame = document.getElementById('frame');
        frame.onload = function () {
            window.removeEventListener('message', onBrowserClicked);
            window.addEventListener('message', onBrowserClicked);
        };
    });

    function onBrowserClicked(msg) {
        if (msg.data) {
            var data = msg.data;
            
            var selectedId = document.getElementById('selectedId');
            var selectedName = document.getElementById('selectedName');
            var selectedType = document.getElementById('selectedType');
            var selectedArea = document.getElementById('selectedArea');
            
            selectedArea.style.display = 'block';

            if (data.params && data.params.event == 'composition_selected') {
                selectedType.innerHTML = 'Type = Composition';
                selectedName.innerHTML = 'Name = ' + data.name;
                selectedId.innerHTML = 'ID = ' + data.params.composition.refId;
            } else if (data.action && data.action == 'ADD_INPUT') {
                selectedType.innerHTML = 'Type = App';
                selectedName.innerHTML = 'Name = ' + data.payload.displayName;
                selectedId.innerHTML = 'Output URL = ' + data.payload.src;
            } else if (data.params && data.params.event == 'image_selected') {
                selectedType.innerHTML = 'Type = Image';
                selectedName.innerHTML = 'Name = ' + data.name;
                selectedId.innerHTML = 'URL = ' + data.params.image.url;
            } else if (data.params && data.params.event == 'audio_selected') {
                selectedType.innerHTML = 'Type = Audio';
                selectedName.innerHTML = 'Name = ' + data.name;
                selectedId.innerHTML = 'URL = ' + data.params.audio.url;
            }
        }
    }

    function showBrowser(type) {
        frame.src = '<%= singularUrlBase %>/externals/browser?type=' + type + '&showSearch=true&showHeader=true';

        var selectedArea = document.getElementById('selectedArea');
        selectedArea.style.display = 'none';
    }
</script>

<body>
    <table style="width: 100%">
        <tr>
            <td style="vertical-align: top; width: 30%">
                <h2>Your profile</h2>
                <ul>
                    <li>Name = <%= user.name %></li>
                    <li>Email = <%= user.email %></li>
                </ul>
                <h2>Play with browsers</h2>
                <ul>
                    <li><a href='#' onClick="showBrowser('composition')">Open Composition Browser</a></li>
                    <li><a href='#' onClick='showBrowser("appinstance")'>Open App Browser</a></li>
                    <li><a href='#' onClick='showBrowser("image")'>Open Image Browser</a></li>
                    <li><a href='#' onClick='showBrowser("audio")'>Open Audio Browser</a></li>
                </ul>
                <a href="<%= singularUrlBase %>/users/logout">Logout</a>
            </td>
            <td style="vertical-align: top;">
                <iframe id="frame" style="border: 0px; width: 100%; height: 600px"></iframe>
                <div id="selectedArea" style="display:none">
                    <h3>Selected Element</h3>
                    <p>
                        <div id="selectedType"></div>
                        <div id="selectedId"></div>
                        <div id="selectedName"></div>
                    </p>
                </div>
            </td>
        </tr>
    </table>

</body>

</html>